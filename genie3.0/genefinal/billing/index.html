<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventa AI Gene - Advanced Inventory Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #010c48 0%, #1e3c72 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #010c48;
        }

        .title-text {
            font-size: 32px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn-header {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-logout {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
        }

        .btn-admin {
            background: linear-gradient(45deg, #4ecdc4, #6bcf7f);
            color: white;
        }

        .btn-reports {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-header:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        /* Navigation Bar */
        .nav-bar {
            background: linear-gradient(135deg, #4d636d 0%, #6c7b7f 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .datetime-display {
            font-size: 16px;
            font-weight: 500;
        }

        .quick-stats {
            display: flex;
            gap: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 15px;
            backdrop-filter: blur(5px);
        }

        /* Main Content Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            padding: 20px;
            min-height: 600px;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-content {
            padding: 20px;
            height: calc(100% - 60px);
            overflow-y: auto;
        }

        /* Products Section */
        .products-card {
            grid-row: span 2;
        }

        .search-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .search-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 8px 0;
        }

        .input-group {
            position: relative;
            flex: 1;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group label {
            position: absolute;
            top: -8px;
            left: 12px;
            background: white;
            padding: 0 5px;
            font-size: 12px;
            color: #667eea;
            font-weight: 600;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffeaa7, #fdcb6e);
            color: #333;
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Enhanced Table */
        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            max-height: 350px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #f1f3f4;
            transition: background-color 0.3s ease;
        }

        tr:hover td {
            background-color: #f8f9fa;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Customer Section */
        .customer-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .customer-full {
            grid-column: 1 / -1;
        }

        /* Loyalty Section */
        .loyalty-card {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .loyalty-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .points-display {
            font-size: 24px;
            font-weight: 700;
        }

        .loyalty-tier {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 12px;
        }

        .rewards-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .reward-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }

        /* Coupons Section */
        .coupons-container {
            max-height: 300px;
            overflow-y: auto;
        }

        .coupon-item {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 5px solid #ff9800;
        }

        .coupon-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .coupon-code {
            font-size: 16px;
            font-weight: 700;
            color: #e65100;
            margin-bottom: 5px;
        }

        .coupon-discount {
            font-size: 20px;
            font-weight: 700;
            color: #d84315;
        }

        .coupon-desc {
            font-size: 12px;
            color: #666;
            margin: 5px 0;
        }

        .coupon-applied {
            background: linear-gradient(135deg, #c8e6c9 0%, #a5d6a7 100%);
            border-left-color: #4caf50;
        }

        /* Cart Enhancements */
        .cart-summary {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .cart-item-count {
            display: inline-block;
            background: #667eea;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            text-align: center;
            line-height: 25px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        /* Bill Section */
        .bill-area {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            min-height: 300px;
            overflow-y: auto;
        }

        .bill-controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .amount-display {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
        }

        .total-amount {
            background: linear-gradient(135deg, #3f51b5 0%, #5c6bc0 100%);
            color: white;
        }

        .discount-amount {
            background: linear-gradient(135deg, #8bc34a 0%, #9ccc65 100%);
            color: white;
        }

        .net-amount {
            background: linear-gradient(135deg, #607d8b 0%, #78909c 100%);
            color: white;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            animation: slideIn 0.6s ease-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .btn:active {
            animation: pulse 0.3s ease;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.5s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .close {
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            color: #666;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #ff6b6b;
        }

        /* Advanced Features */
        .feature-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .tab-button {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Analytics Dashboard */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            max-width: 400px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .notification.warning {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #333;
        }

        /* Dark Mode Support */
        .dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }

        .dark-mode .card {
            background: #34495e;
            color: white;
        }

        .dark-mode .input-group input {
            background: #2c3e50;
            color: white;
            border-color: #4a5f7a;
        }

        /* Mobile Responsiveness */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .customer-form {
                grid-template-columns: 1fr;
            }
            
            .bill-controls {
                grid-template-columns: 1fr;
            }
        }

        /* Footer */
        .footer {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 14px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .social-links {
            display: flex;
            gap: 15px;
        }

        .social-links a {
            color: white;
            text-decoration: none;
            padding: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .social-links a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Notification Container -->
    <div id="notification" class="notification"></div>

    <div class="container">
        <!-- Enhanced Header -->
        <div class="header">
            <div class="logo-section">
                <div class="logo">🏪</div>
                <div>
                    <div class="title-text">Inventa AI Gene</div>
                    <div style="font-size: 14px; opacity: 0.8;">Advanced Inventory Management System</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn-header btn-admin" onclick="openAdminPanel()">
                    📊 Admin Panel
                </button>
                <button class="btn-header btn-reports" onclick="generateReports()">
                    📈 Reports
                </button>
                <button class="btn-header" style="background: #6c5ce7; color: white;" onclick="toggleDarkMode()">
                    🌙 Dark Mode
                </button>
                <button class="btn-header btn-logout" onclick="logout()">
                    🚪 Logout
                </button>
            </div>
        </div>

        <!-- Enhanced Navigation -->
        <div class="nav-bar">
            <div class="datetime-display" id="datetime">
                📅 Loading... | ⏰ Loading...
            </div>
            <div class="quick-stats">
                <div class="stat-item">
                    📦 Products: <span id="totalProducts">0</span>
                </div>
                <div class="stat-item">
                    💰 Today's Sales: <span id="todaySales">₹0</span>
                </div>
                <div class="stat-item">
                    👥 Customers: <span id="totalCustomers">0</span>
                </div>
            </div>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Products Section -->
            <div class="card products-card">
                <div class="card-header">
                    📦 Product Management
                    <div class="feature-tabs" style="margin-left: auto; width: 200px;">
                        <button class="tab-button active" onclick="switchTab('products')">Products</button>
                        <button class="tab-button" onclick="switchTab('inventory')">Inventory</button>
                    </div>
                </div>
                <div class="card-content">
                    <!-- Products Tab -->
                    <div id="products-tab" class="tab-content active">
                        <div class="search-container">
                            <div class="search-row">
                                <div class="input-group">
                                    <label>Search Product</label>
                                    <input type="text" id="searchInput" placeholder="Enter product name...">
                                </div>
                                <button class="btn btn-primary" onclick="searchProducts()">🔍 Search</button>
                                <button class="btn btn-success" onclick="showAllProducts()">📋 Show All</button>
                            </div>
                            <div class="search-row">
                                <button class="btn btn-warning" onclick="openAddProductModal()">➕ Add Product</button>
                                <button class="btn" style="background: #6c5ce7; color: white;" onclick="exportProducts()">📤 Export</button>
                                <button class="btn" style="background: #fd79a8; color: white;" onclick="openBarcodeScanner()">📷 Scan</button>
                            </div>
                        </div>

                        <div class="table-container">
                            <table id="productsTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Product Name</th>
                                        <th>Price</th>
                                        <th>Stock</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Inventory Tab -->
                    <div id="inventory-tab" class="tab-content">
                        <div class="analytics-grid">
                            <div class="metric-card">
                                <div class="metric-value" id="lowStockCount">0</div>
                                <div class="metric-label">Low Stock Items</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="outOfStockCount">0</div>
                                <div class="metric-label">Out of Stock</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="totalInventoryValue">₹0</div>
                                <div class="metric-label">Inventory Value</div>
                            </div>
                        </div>
                        <div class="table-container">
                            <table id="inventoryTable">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Current Stock</th>
                                        <th>Reorder Level</th>
                                        <th>Last Updated</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer & Cart Section -->
            <div class="card">
                <div class="card-header">
                    👥 Customer & Cart Management
                    <div class="cart-item-count" id="cartCount">0</div>
                </div>
                <div class="card-content">
                    <!-- Customer Details -->
                    <div class="customer-form">
                        <div class="input-group">
                            <label>Customer Name</label>
                            <input type="text" id="customerName" placeholder="Enter customer name">
                        </div>
                        <div class="input-group">
                            <label>Contact Number</label>
                            <input type="text" id="customerContact" placeholder="Enter contact number">
                        </div>
                        <div class="input-group">
                            <label>Email Address</label>
                            <input type="email" id="customerEmail" placeholder="Enter email address">
                        </div>
                        <div class="input-group">
                            <label>Customer ID</label>
                            <input type="text" id="customerId" placeholder="Auto-generated" readonly>
                        </div>
                        <div class="customer-full">
                            <button class="btn btn-primary" onclick="checkCustomer()" style="width: 100%; margin-bottom: 10px;">
                                🔍 Check Customer & Load Loyalty Points
                            </button>
                        </div>
                    </div>

                    <!-- Loyalty Card -->
                    <div class="loyalty-card">
                        <div class="loyalty-header">
                            <div>
                                <div class="points-display" id="loyaltyPoints">0 Points</div>
                                <div>Loyalty Member</div>
                            </div>
                            <div class="loyalty-tier" id="loyaltyTier">Bronze</div>
                        </div>
                        <div class="rewards-grid">
                            <div class="reward-item">
                                <div style="font-weight: 600;">Points to Earn</div>
                                <div id="pointsToEarn">0</div>
                            </div>
                            <div class="reward-item">
                                <div style="font-weight: 600;">Next Reward</div>
                                <div id="nextReward">100 pts</div>
                            </div>
                        </div>
                    </div>

                    <!-- Cart Table -->
                    <div class="table-container" style="max-height: 200px;">
                        <table id="cartTable">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Price</th>
                                    <th>Qty</th>
                                    <th>Total</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <!-- Add to Cart -->
                    <div class="cart-summary">
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <div class="input-group">
                                <label>Selected Product</label>
                                <input type="text" id="selectedProduct" readonly>
                            </div>
                            <div class="input-group">
                                <label>Price</label>
                                <input type="text" id="selectedPrice" readonly>
                            </div>
                            <div class="input-group">
                                <label>Quantity</label>
                                <input type="number" id="selectedQty" min="0" value="1">
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="addToCart()" style="flex: 1;">➕ Add to Cart</button>
                            <button class="btn btn-warning" onclick="clearCart()">🗑️ Clear Cart</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Billing & Coupons Section -->
            <div class="card">
                <div class="card-header">
                    💰 Billing & Offers
                </div>
                <div class="card-content">
                    <!-- Coupons Section -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: #667eea;">🎫 Available Coupons</h4>
                        <div class="input-group" style="margin-bottom: 10px;">
                            <label>Enter Coupon Code</label>
                            <input type="text" id="couponCode" placeholder="Enter coupon code">
                        </div>
                        <button class="btn btn-success" onclick="applyCoupon()" style="width: 100%; margin-bottom: 15px;">
                            ✨ Apply Coupon
                        </button>
                        
                        <div class="coupons-container" style="max-height: 200px;">
                            <div id="couponsList"></div>
                        </div>
                        <div id="appliedCoupons"></div>
                    </div>

                    <!-- Bill Area -->
                    <div class="bill-area" id="billArea">
                        Generate bill to view receipt...
                    </div>

                    <!-- Bill Controls -->
                    <div class="bill-controls">
                        <div class="amount-display total-amount">
                            <div>Total Amount</div>
                            <div id="totalAmount">₹0.00</div>
                        </div>
                        <div class="amount-display discount-amount">
                            <div>Total Discount</div>
                            <div id="totalDiscount">₹0.00</div>
                        </div>
                        <div class="amount-display net-amount">
                            <div>Net Payable</div>
                            <div id="netAmount">₹0.00</div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                        <div class="input-group">
                            <label>Additional Discount (%)</label>
                            <input type="number" id="additionalDiscount" value="0" min="0" max="100" oninput="updateBill()">
                        </div>
                        <div class="input-group">
                            <label>Tax Rate (%)</label>
                            <input type="number" id="taxRate" value="0" min="0" max="50" oninput="updateBill()">
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px;">
                        <button class="btn btn-success" onclick="generateBill()">📄 Generate Bill</button>
                        <button class="btn btn-primary" onclick="printBill()">🖨️ Print Bill</button>
                        <button class="btn btn-danger" onclick="clearAll()">🗑️ Clear All</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-content">
                <div>© 2025 Inventa AI Gene - Advanced Inventory Management System</div>
                <div class="social-links">
                    <a href="#" title="Facebook">📘</a>
                    <a href="#" title="Twitter">🐦</a>
                    <a href="#" title="LinkedIn">💼</a>
                    <a href="#" title="Instagram">📷</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📊 Admin Panel</h2>
                <span class="close" onclick="closeModal('adminModal')">&times;</span>
            </div>
            <div class="analytics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="totalSalesValue">₹0</div>
                    <div class="metric-label">Total Sales</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="totalOrdersValue">0</div>
                    <div class="metric-label">Total Orders</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avgOrderValue">₹0</div>
                    <div class="metric-label">Avg Order Value</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="loyalCustomers">0</div>
                    <div class="metric-label">Loyal Customers</div>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <h4>Recent Activities</h4>
                <div id="recentActivities" style="max-height: 200px; overflow-y: auto;">
                    <!-- Recent activities will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>➕ Add New Product</h2>
                <span class="close" onclick="closeModal('addProductModal')">&times;</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="input-group">
                    <label>Product Name</label>
                    <input type="text" id="newProductName" placeholder="Enter product name">
                </div>
                <div class="input-group">
                    <label>Product Price (₹)</label>
                    <input type="number" id="newProductPrice" placeholder="Enter price" step="0.01">
                </div>
                <div class="input-group">
                    <label>Initial Stock</label>
                    <input type="number" id="newProductStock" placeholder="Enter stock quantity">
                </div>
                <div class="input-group">
                    <label>Category</label>
                    <select id="newProductCategory">
                        <option value="Electronics">Electronics</option>
                        <option value="Accessories">Accessories</option>
                        <option value="Computers">Computers</option>
                        <option value="Mobile">Mobile</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            <div class="input-group" style="margin-top: 15px;">
                <label>Product Description</label>
                <textarea id="newProductDesc" placeholder="Enter product description" rows="3" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;"></textarea>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end;">
                <button class="btn btn-danger" onclick="closeModal('addProductModal')">❌ Cancel</button>
                <button class="btn btn-success" onclick="addNewProduct()">✅ Add Product</button>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Global Variables
        let products = [
            {pid: 1, name: 'Laptop Dell XPS', price: 85000, qty: 10, status: 'Active', category: 'Computers', reorderLevel: 5, lastUpdated: new Date()},
            {pid: 2, name: 'iPhone 14 Pro', price: 125000, qty: 5, status: 'Active', category: 'Mobile', reorderLevel: 3, lastUpdated: new Date()},
            {pid: 3, name: 'Samsung Galaxy S23', price: 95000, qty: 8, status: 'Active', category: 'Mobile', reorderLevel: 5, lastUpdated: new Date()},
            {pid: 4, name: 'MacBook Air M2', price: 115000, qty: 3, status: 'Active', category: 'Computers', reorderLevel: 2, lastUpdated: new Date()},
            {pid: 5, name: 'Sony Headphones', price: 25000, qty: 15, status: 'Active', category: 'Accessories', reorderLevel: 8, lastUpdated: new Date()},
            {pid: 6, name: 'Logitech Mouse', price: 2500, qty: 20, status: 'Active', category: 'Accessories', reorderLevel: 10, lastUpdated: new Date()},
            {pid: 7, name: 'Mechanical Keyboard', price: 8500, qty: 12, status: 'Active', category: 'Accessories', reorderLevel: 6, lastUpdated: new Date()},
            {pid: 8, name: '4K Monitor', price: 45000, qty: 6, status: 'Active', category: 'Electronics', reorderLevel: 3, lastUpdated: new Date()},
            {pid: 9, name: 'USB-C Hub', price: 3500, qty: 25, status: 'Active', category: 'Accessories', reorderLevel: 15, lastUpdated: new Date()},
            {pid: 10, name: 'Webcam HD', price: 7500, qty: 18, status: 'Active', category: 'Electronics', reorderLevel: 10, lastUpdated: new Date()}
        ];

        let cart = [];
        let customers = JSON.parse(localStorage.getItem('customers')) || {};
        let currentCustomer = null;
        let appliedCoupons = [];
        let totalSales = parseFloat(localStorage.getItem('totalSales')) || 0;
        let totalOrders = parseInt(localStorage.getItem('totalOrders')) || 0;
        let isDarkMode = false;
        let activities = JSON.parse(localStorage.getItem('activities')) || [];

        // Enhanced Coupons with more variety
        const availableCoupons = [
            {code: 'WELCOME10', discount: 10, type: 'percentage', minAmount: 1000, maxDiscount: 2000, description: '10% off for new customers', icon: '🎉'},
            {code: 'SAVE500', discount: 500, type: 'flat', minAmount: 5000, maxDiscount: 500, description: 'Flat ₹500 off on orders above ₹5000', icon: '💰'},
            {code: 'LOYALTY15', discount: 15, type: 'percentage', minAmount: 2000, maxDiscount: 5000, description: '15% off for loyal customers', icon: '⭐'},
            {code: 'BULK20', discount: 20, type: 'percentage', minAmount: 20000, maxDiscount: 8000, description: '20% off on bulk orders', icon: '📦'},
            {code: 'TECH25', discount: 25, type: 'percentage', minAmount: 15000, maxDiscount: 10000, description: '25% off on tech products', icon: '💻'},
            {code: 'WEEKEND12', discount: 12, type: 'percentage', minAmount: 3000, maxDiscount: 3000, description: 'Weekend special discount', icon: '🎯'},
            {code: 'STUDENT5', discount: 5, type: 'percentage', minAmount: 500, maxDiscount: 1000, description: 'Student discount', icon: '🎓'},
            {code: 'FLASH1000', discount: 1000, type: 'flat', minAmount: 10000, maxDiscount: 1000, description: 'Flash sale - ₹1000 off', icon: '⚡'}
        ];

        // Enhanced Loyalty System
        const loyaltyTiers = [
            {name: 'Bronze', minPoints: 0, multiplier: 1, perks: ['Basic rewards']},
            {name: 'Silver', minPoints: 300, multiplier: 1.2, perks: ['Enhanced rewards', '5% bonus points']},
            {name: 'Gold', minPoints: 750, multiplier: 1.5, perks: ['Premium rewards', '10% bonus points', 'Priority support']},
            {name: 'Platinum', minPoints: 1500, multiplier: 2, perks: ['Exclusive rewards', '15% bonus points', 'VIP treatment']}
        ];

        const loyaltyRewards = [
            {points: 50, reward: '₹25 cashback', value: 25, type: 'cashback'},
            {points: 100, reward: '₹75 cashback', value: 75, type: 'cashback'},
            {points: 200, reward: '₹200 cashback', value: 200, type: 'cashback'},
            {points: 300, reward: 'Free shipping', value: 100, type: 'shipping'},
            {points: 500, reward: '₹500 cashback', value: 500, type: 'cashback'},
            {points: 750, reward: '₹1000 cashback', value: 1000, type: 'cashback'},
            {points: 1000, reward: 'VIP membership', value: 2000, type: 'membership'}
        ];

        // Initialize App
        window.onload = function() {
            initializeApp();
        };

        function initializeApp() {
            updateDateTime();
            displayProducts();
            displayCoupons();
            updateDashboard();
            updateInventoryMetrics();
            displayRecentActivities();
            
            // Auto-save data every 30 seconds
            setInterval(saveAllData, 30000);
        }

        // Enhanced DateTime
        function updateDateTime() {
            const now = new Date();
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            };
            
            const dateStr = now.toLocaleDateString('en-IN', dateOptions);
            const timeStr = now.toLocaleTimeString('en-IN', timeOptions);
            
            document.getElementById('datetime').innerHTML = `📅 ${dateStr} | ⏰ ${timeStr}`;
            setTimeout(updateDateTime, 1000);
        }

        // Enhanced Product Management
        function displayProducts() {
            const tbody = document.querySelector('#productsTable tbody');
            tbody.innerHTML = '';
            
            products.forEach(product => {
                const row = tbody.insertRow();
                const statusClass = product.status === 'Active' ? 'status-active' : 'status-inactive';
                const lowStock = product.qty <= product.reorderLevel;
                
                row.innerHTML = `
                    <td>${product.pid}</td>
                    <td>${product.name} ${lowStock ? '⚠️' : ''}</td>
                    <td>₹${product.price.toLocaleString()}</td>
                    <td>${product.qty} ${lowStock ? '<span style="color: red;">(Low)</span>' : ''}</td>
                    <td><span class="${statusClass}">${product.status}</span></td>
                    <td>
                        <button class="btn btn-primary" onclick="selectProduct(${product.pid})" style="padding: 5px 10px; font-size: 12px;">Select</button>
                        <button class="btn btn-warning" onclick="editProduct(${product.pid})" style="padding: 5px 10px; font-size: 12px;">Edit</button>
                    </td>
                `;
                
                if (lowStock) {
                    row.style.backgroundColor = '#fff3cd';
                }
                
                row.onclick = () => selectProduct(product.pid);
            });
        }

        function selectProduct(pid) {
            const product = products.find(p => p.pid === pid);
            if (product && product.status === 'Active') {
                document.getElementById('selectedProduct').value = product.name;
                document.getElementById('selectedPrice').value = `₹${product.price}`;
                document.getElementById('selectedQty').value = 1;
                document.getElementById('selectedQty').max = product.qty;
                
                // Highlight selected row
                document.querySelectorAll('#productsTable tbody tr').forEach(row => {
                    row.style.backgroundColor = '';
                });
                event.target.closest('tr').style.backgroundColor = '#e3f2fd';
                
                showNotification(`Selected: ${product.name}`, 'success');
            }
        }

        function searchProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (!searchTerm) {
                displayProducts();
                return;
            }
            
            const filteredProducts = products.filter(p => 
                p.name.toLowerCase().includes(searchTerm) ||
                p.category.toLowerCase().includes(searchTerm)
            );
            
            const tbody = document.querySelector('#productsTable tbody');
            tbody.innerHTML = '';
            
            if (filteredProducts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666;">No products found</td></tr>';
                return;
            }
            
            filteredProducts.forEach(product => {
                const row = tbody.insertRow();
                const statusClass = product.status === 'Active' ? 'status-active' : 'status-inactive';
                
                row.innerHTML = `
                    <td>${product.pid}</td>
                    <td>${product.name}</td>
                    <td>₹${product.price.toLocaleString()}</td>
                    <td>${product.qty}</td>
                    <td><span class="${statusClass}">${product.status}</span></td>
                    <td>
                        <button class="btn btn-primary" onclick="selectProduct(${product.pid})" style="padding: 5px 10px; font-size: 12px;">Select</button>
                    </td>
                `;
                row.onclick = () => selectProduct(product.pid);
            });
        }

        function showAllProducts() {
            document.getElementById('searchInput').value = '';
            displayProducts();
        }

        // Enhanced Cart Management
        function addToCart() {
            const productName = document.getElementById('selectedProduct').value;
            const price = document.getElementById('selectedPrice').value.replace('₹', '').replace(',', '');
            const qty = parseInt(document.getElementById('selectedQty').value);
            
            if (!productName || !price || !qty || qty <= 0) {
                showNotification('Please select a product and valid quantity', 'error');
                return;
            }
            
            const product = products.find(p => p.name === productName);
            if (!product) {
                showNotification('Product not found', 'error');
                return;
            }
            
            if (qty > product.qty) {
                showNotification(`Only ${product.qty} items available in stock`, 'error');
                return;
            }
            
            const existingItem = cart.find(item => item.pid === product.pid);
            
            if (existingItem) {
                if (existingItem.qty + qty > product.qty) {
                    showNotification(`Cannot add more. Total would exceed stock (${product.qty})`, 'error');
                    return;
                }
                existingItem.qty += qty;
                showNotification(`Updated ${product.name} quantity in cart`, 'success');
            } else {
                cart.push({
                    pid: product.pid,
                    name: product.name,
                    price: parseFloat(price),
                    qty: qty,
                    total: parseFloat(price) * qty
                });
                showNotification(`Added ${product.name} to cart`, 'success');
            }
            
            updateCartDisplay();
            updateBill();
            clearSelection();
            addActivity(`Added ${qty}x ${product.name} to cart`);
        }

        function updateCartDisplay() {
            const tbody = document.querySelector('#cartTable tbody');
            tbody.innerHTML = '';
            
            cart.forEach((item, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>₹${item.price.toLocaleString()}</td>
                    <td>
                        <input type="number" value="${item.qty}" min="1" max="100" 
                               onchange="updateCartItemQty(${index}, this.value)" 
                               style="width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                    </td>
                    <td>₹${(item.price * item.qty).toLocaleString()}</td>
                    <td>
                        <button class="btn btn-danger" onclick="removeFromCart(${index})" 
                                style="padding: 5px 10px; font-size: 12px;">🗑️</button>
                    </td>
                `;
            });
            
            document.getElementById('cartCount').textContent = cart.length;
            updateBill();
        }

        function updateCartItemQty(index, newQty) {
            const qty = parseInt(newQty);
            if (qty <= 0) {
                removeFromCart(index);
                return;
            }
            
            const item = cart[index];
            const product = products.find(p => p.pid === item.pid);
            
            if (qty > product.qty) {
                showNotification(`Only ${product.qty} items available`, 'error');
                updateCartDisplay();
                return;
            }
            
            cart[index].qty = qty;
            cart[index].total = item.price * qty;
            updateCartDisplay();
            showNotification('Cart updated', 'success');
        }

        function removeFromCart(index) {
            const item = cart[index];
            cart.splice(index, 1);
            updateCartDisplay();
            showNotification(`Removed ${item.name} from cart`, 'warning');
            addActivity(`Removed ${item.name} from cart`);
        }

        function clearCart() {
            cart = [];
            updateCartDisplay();
            clearSelection();
            showNotification('Cart cleared', 'warning');
        }

        function clearSelection() {
            document.getElementById('selectedProduct').value = '';
            document.getElementById('selectedPrice').value = '';
            document.getElementById('selectedQty').value = '1';
            
            // Remove highlights
            document.querySelectorAll('#productsTable tbody tr').forEach(row => {
                row.style.backgroundColor = '';
            });
        }

        // Enhanced Customer Management
        function checkCustomer() {
            const name = document.getElementById('customerName').value.trim();
            const contact = document.getElementById('customerContact').value.trim();
            const email = document.getElementById('customerEmail').value.trim();
            
            if (!name || !contact) {
                showNotification('Please enter customer name and contact', 'error');
                return;
            }
            
            const customerId = generateCustomerId(name, contact);
            document.getElementById('customerId').value = customerId;
            
            if (!customers[customerId]) {
                customers[customerId] = {
                    name: name,
                    contact: contact,
                    email: email,
                    points: 0,
                    totalSpent: 0,
                    orders: 0,
                    joinDate: new Date().toISOString(),
                    tier: 'Bronze'
                };
                showNotification('New customer registered! Welcome to our loyalty program!', 'success');
                addActivity(`New customer registered: ${name}`);
            } else {
                // Update email if provided
                if (email) customers[customerId].email = email;
                showNotification(`Welcome back, ${name}! Loyalty points: ${customers[customerId].points}`, 'success');
            }
            
            currentCustomer = customers[customerId];
            updateLoyaltyDisplay();
            saveCustomerData();
        }

        function generateCustomerId(name, contact) {
            return name.substring(0, 3).toUpperCase() + contact.slice(-4);
        }

        function updateLoyaltyDisplay() {
            if (!currentCustomer) {
                document.getElementById('loyaltyPoints').textContent = '0 Points';
                document.getElementById('loyaltyTier').textContent = 'Bronze';
                document.getElementById('pointsToEarn').textContent = '0';
                document.getElementById('nextReward').textContent = '50 pts';
                return;
            }
            
            const tier = getLoyaltyTier(currentCustomer.points);
            const cartTotal = cart.reduce((sum, item) => sum + item.total, 0);
            const pointsToEarn = Math.floor(cartTotal / 100) * tier.multiplier;
            const nextReward = loyaltyRewards.find(r => r.points > currentCustomer.points);
            
            document.getElementById('loyaltyPoints').textContent = `${currentCustomer.points} Points`;
            document.getElementById('loyaltyTier').textContent = tier.name;
            document.getElementById('pointsToEarn').textContent = Math.floor(pointsToEarn);
            document.getElementById('nextReward').textContent = nextReward ? `${nextReward.points} pts - ${nextReward.reward}` : 'Max reached!';
            
            currentCustomer.tier = tier.name;
        }

        function getLoyaltyTier(points) {
            return loyaltyTiers.slice().reverse().find(tier => points >= tier.minPoints) || loyaltyTiers[0];
        }

        // Enhanced Coupon System
        function displayCoupons() {
            const couponsList = document.getElementById('couponsList');
            couponsList.innerHTML = '';
            
            availableCoupons.forEach(coupon => {
                const cartTotal = cart.reduce((sum, item) => sum + item.total, 0);
                const isEligible = cartTotal >= coupon.minAmount;
                const isApplied = appliedCoupons.some(c => c.code === coupon.code);
                
                const couponDiv = document.createElement('div');
                couponDiv.className = `coupon-item ${isApplied ? 'coupon-applied' : ''}`;
                couponDiv.style.opacity = isEligible ? '1' : '0.6';
                
                couponDiv.innerHTML = `
                    <div class="coupon-code">${coupon.icon} ${coupon.code}</div>
                    <div class="coupon-discount">${coupon.type === 'percentage' ? coupon.discount + '%' : '₹' + coupon.discount} OFF</div>
                    <div class="coupon-desc">${coupon.description}</div>
                    <div class="coupon-desc">Min order: ₹${coupon.minAmount.toLocaleString()}</div>
                    ${!isEligible ? '<div class="coupon-desc" style="color: red;">Not eligible - increase cart value</div>' : ''}
                    ${isApplied ? '<div class="coupon-desc" style="color: green;">✅ Applied</div>' : ''}
                `;
                
                if (isEligible && !isApplied) {
                    couponDiv.onclick = () => {
                        document.getElementById('couponCode').value = coupon.code;
                        applyCoupon();
                    };
                }
                
                couponsList.appendChild(couponDiv);
            });
        }

        function applyCoupon() {
            const code = document.getElementById('couponCode').value.toUpperCase().trim();
            if (!code) {
                showNotification('Please enter a coupon code', 'error');
                return;
            }
            
            if (appliedCoupons.some(c => c.code === code)) {
                showNotification('Coupon already applied', 'warning');
                return;
            }
            
            const coupon = availableCoupons.find(c => c.code === code);
            if (!coupon) {
                showNotification('Invalid coupon code', 'error');
                return;
            }
            
            const cartTotal = cart.reduce((sum, item) => sum + item.total, 0);
            if (cartTotal < coupon.minAmount) {
                showNotification(`Minimum order amount should be ₹${coupon.minAmount.toLocaleString()}`, 'error');
                return;
            }
            
            appliedCoupons.push(coupon);
            document.getElementById('couponCode').value = '';
            updateBill();
            displayCoupons();
            displayAppliedCoupons();
            showNotification(`Coupon ${code} applied successfully!`, 'success');
            addActivity(`Applied coupon: ${code}`);
        }

        function displayAppliedCoupons() {
            const appliedDiv = document.getElementById('appliedCoupons');
            if (appliedCoupons.length === 0) {
                appliedDiv.innerHTML = '';
                return;
            }
            
            appliedDiv.innerHTML = appliedCoupons.map(coupon => `
                <div class="coupon-item coupon-applied">
                    <div class="coupon-code">${coupon.icon} ${coupon.code} ✅</div>
                    <div class="coupon-desc">${coupon.description}</div>
                    <button class="btn btn-danger" onclick="removeCoupon('${coupon.code}')" 
                            style="margin-top: 10px; padding: 5px 10px; font-size: 12px;">Remove</button>
                </div>
            `).join('');
        }

        function removeCoupon(code) {
            appliedCoupons = appliedCoupons.filter(c => c.code !== code);
            updateBill();
            displayCoupons();
            displayAppliedCoupons();
            showNotification(`Coupon ${code} removed`, 'warning');
        }

        // Enhanced Billing System
        function updateBill() {
            const cartTotal = cart.reduce((sum, item) => sum + item.total, 0);
            let totalDiscount = 0;
            
            // Calculate coupon discounts
            appliedCoupons.forEach(coupon => {
                if (coupon.type === 'percentage') {
                    const discount = Math.min((cartTotal * coupon.discount) / 100, coupon.maxDiscount);
                    totalDiscount += discount;
                } else {
                    totalDiscount += coupon.discount;
                }
            });
            
            // Add additional discount
            const additionalDiscount = parseFloat(document.getElementById('additionalDiscount').value) || 0;
            totalDiscount += (cartTotal * additionalDiscount) / 100;
            
            // Calculate tax
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const taxableAmount = cartTotal - totalDiscount;
            const taxAmount = (taxableAmount * taxRate) / 100;
            const netAmount = taxableAmount + taxAmount;
            
            document.getElementById('totalAmount').textContent = `₹${cartTotal.toLocaleString()}`;
            document.getElementById('totalDiscount').textContent = `₹${totalDiscount.toLocaleString()}`;
            document.getElementById('netAmount').textContent = `₹${netAmount.toLocaleString()}`;
            
            updateLoyaltyDisplay();
        }

        function generateBill() {
            const customerName = document.getElementById('customerName').value.trim();
            const customerContact = document.getElementById('customerContact').value.trim();
            
            if (!customerName || !customerContact) {
                showNotification('Please enter customer details', 'error');
                return;
            }
            
            if (cart.length === 0) {
                showNotification('Please add items to cart', 'error');
                return;
            }
            
            const billNumber = 'INV' + Date.now();
            const currentDate = new Date();
            const cartTotal = cart.reduce((sum, item) => sum + item.total, 0);
            let totalDiscount = 0;
            
            // Calculate discounts
            appliedCoupons.forEach(coupon => {
                if (coupon.type === 'percentage') {
                    totalDiscount += Math.min((cartTotal * coupon.discount) / 100, coupon.maxDiscount);
                } else {
                    totalDiscount += coupon.discount;
                }
            });
            
            const additionalDiscount = (cartTotal * (parseFloat(document.getElementById('additionalDiscount').value) || 0)) / 100;
            totalDiscount += additionalDiscount;
            
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const taxableAmount = cartTotal - totalDiscount;
            const taxAmount = (taxableAmount * taxRate) / 100;
            const netAmount = taxableAmount + taxAmount;
            
            // Generate bill content
            let billContent = `
    ═══════════════════════════════════════════════
                    INVENTA AI GENE
                Advanced Inventory System
    ═══════════════════════════════════════════════
    
    Bill No: ${billNumber}
    Date: ${currentDate.toLocaleDateString('en-IN')}
    Time: ${currentDate.toLocaleTimeString('en-IN')}
    
    Customer Details:
    Name: ${customerName}
    Contact: ${customerContact}
    ${currentCustomer ? `Customer ID: ${document.getElementById('customerId').value}` : ''}
    ${currentCustomer ? `Loyalty Tier: ${currentCustomer.tier}` : ''}
    
    ═══════════════════════════════════════════════
    ITEMS PURCHASED:
    ═══════════════════════════════════════════════
    `;
            
            cart.forEach(item => {
                billContent += `
    ${item.name}
    Qty: ${item.qty} × ₹${item.price.toLocaleString()} = ₹${item.total.toLocaleString()}
    `;
            });
            
            billContent += `
    ═══════════════════════════════════════════════
    BILL SUMMARY:
    ═══════════════════════════════════════════════
    Subtotal:                        ₹${cartTotal.toLocaleString()}
    `;
            
            if (appliedCoupons.length > 0) {
                billContent += `\n    Applied Coupons:\n`;
                appliedCoupons.forEach(coupon => {
                    const discount = coupon.type === 'percentage' 
                        ? Math.min((cartTotal * coupon.discount) / 100, coupon.maxDiscount)
                        : coupon.discount;
                    billContent += `    - ${coupon.code}: -₹${discount.toLocaleString()}\n`;
                });
            }
            
            if (additionalDiscount > 0) {
                billContent += `    Additional Discount:            -₹${additionalDiscount.toLocaleString()}\n`;
            }
            
            if (taxAmount > 0) {
                billContent += `    Tax (${taxRate}%):                     +₹${taxAmount.toLocaleString()}\n`;
            }
            
            billContent += `    Total Discount:                 -₹${totalDiscount.toLocaleString()}
    ═══════════════════════════════════════════════
    NET PAYABLE:                     ₹${netAmount.toLocaleString()}
    ═══════════════════════════════════════════════
    `;
            
            if (currentCustomer) {
                const pointsEarned = Math.floor(netAmount / 100);
                const tier = getLoyaltyTier(currentCustomer.points);
                const bonusPoints = Math.floor(pointsEarned * (tier.multiplier - 1));
                const totalPointsEarned = pointsEarned + bonusPoints;
                
                billContent += `
    LOYALTY INFORMATION:
    Points Earned: ${pointsEarned}${bonusPoints > 0 ? ` + ${bonusPoints} bonus` : ''} = ${totalPointsEarned}
    Total Points: ${currentCustomer.points + totalPointsEarned}
    Tier: ${tier.name}
    `;
                
                // Update customer data
                currentCustomer.points += totalPointsEarned;
                currentCustomer.totalSpent += netAmount;
                currentCustomer.orders += 1;
                saveCustomerData();
            }
            
            billContent += `
    ═══════════════════════════════════════════════
    Thank you for shopping with us!
    Visit us again for more great deals!
    ═══════════════════════════════════════════════
    `;
            
            document.getElementById('billArea').textContent = billContent;
            
            // Update inventory
            cart.forEach(item => {
                const product = products.find(p => p.pid === item.pid);
                if (product) {
                    product.qty -= item.qty;
                    if (product.qty <= 0) {
                        product.status = 'Inactive';
                    }
                    product.lastUpdated = new Date();
                }
            });
            
            // Update sales data
            totalSales += netAmount;
            totalOrders += 1;
            localStorage.setItem('totalSales', totalSales.toString());
            localStorage.setItem('totalOrders', totalOrders.toString());
            
            // Add activity
            addActivity(`Generated bill ${billNumber} for ₹${netAmount.toLocaleString()}`);
            
            displayProducts();
            updateDashboard();
            updateInventoryMetrics();
            showNotification('Bill generated successfully!', 'success');
        }

        function printBill() {
            const billContent = document.getElementById('billArea').textContent;
            if (!billContent || billContent.includes('Generate bill')) {
                showNotification('Please generate a bill first', 'error');
                return;
            }
            
            const printWindow = window.open('', '_blank', 'width=800,height=600');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Bill Receipt</title>
                        <style>
                            body { 
                                font-family: 'Courier New', monospace; 
                                white-space: pre-wrap; 
                                margin: 20px;
                                font-size: 12px;
                            }
                            @media print {
                                body { margin: 0; }
                            }
                        </style>
                    </head>
                    <body>${billContent}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
            
            addActivity('Printed bill receipt');
        }

        function clearAll() {
            if (!confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                return;
            }
            
            cart = [];
            appliedCoupons = [];
            currentCustomer = null;
            
            document.getElementById('customerName').value = '';
            document.getElementById('customerContact').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('customerId').value = '';
            document.getElementById('couponCode').value = '';
            document.getElementById('additionalDiscount').value = '0';
            document.getElementById('taxRate').value = '0';
            document.getElementById('billArea').textContent = 'Generate bill to view receipt...';
            
            updateCartDisplay();
            updateBill();
            updateLoyaltyDisplay();
            displayCoupons();
            displayAppliedCoupons();
            clearSelection();
            
            showNotification('All data cleared', 'warning');
            addActivity('Cleared all transaction data');
        }

        // Tab Management
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            if (tabName === 'inventory') {
                updateInventoryMetrics();
                displayInventoryTable();
            }
        }

        function updateInventoryMetrics() {
            const lowStockItems = products.filter(p => p.qty <= p.reorderLevel && p.status === 'Active');
            const outOfStockItems = products.filter(p => p.qty === 0);
            const totalValue = products.reduce((sum, p) => sum + (p.price * p.qty), 0);
            
            document.getElementById('lowStockCount').textContent = lowStockItems.length;
            document.getElementById('outOfStockCount').textContent = outOfStockItems.length;
            document.getElementById('totalInventoryValue').textContent = `₹${totalValue.toLocaleString()}`;
        }

        function displayInventoryTable() {
            const tbody = document.querySelector('#inventoryTable tbody');
            tbody.innerHTML = '';
            
            products.forEach(product => {
                const row = tbody.insertRow();
                const stockStatus = product.qty <= product.reorderLevel ? 'Low Stock' : 
                                  product.qty === 0 ? 'Out of Stock' : 'In Stock';
                const statusColor = product.qty <= product.reorderLevel ? 'red' : 
                                  product.qty === 0 ? 'darkred' : 'green';
                
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.qty}</td>
                    <td>${product.reorderLevel}</td>
                    <td>${product.lastUpdated.toLocaleDateString()}</td>
                    <td style="color: ${statusColor}; font-weight: 600;">${stockStatus}</td>
                `;
                
                if (product.qty <= product.reorderLevel) {
                    row.style.backgroundColor = '#fff3cd';
                }
            });
        }

        // Dashboard Updates
        function updateDashboard() {
            document.getElementById('totalProducts').textContent = products.filter(p => p.status === 'Active').length;
            document.getElementById('todaySales').textContent = `₹${totalSales.toLocaleString()}`;
            document.getElementById('totalCustomers').textContent = Object.keys(customers).length;
            
            // Update admin panel metrics
            document.getElementById('totalSalesValue').textContent = `₹${totalSales.toLocaleString()}`;
            document.getElementById('totalOrdersValue').textContent = totalOrders;
            document.getElementById('avgOrderValue').textContent = totalOrders > 0 ? `₹${Math.round(totalSales / totalOrders).toLocaleString()}` : '₹0';
            document.getElementById('loyalCustomers').textContent = Object.values(customers).filter(c => c.points > 100).length;
        }

        // Modal Management
        function openAdminPanel() {
            document.getElementById('adminModal').style.display = 'block';
            updateDashboard();
            displayRecentActivities();
        }

        function openAddProductModal() {
            document.getElementById('addProductModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Enhanced Features
        function addNewProduct() {
            const name = document.getElementById('newProductName').value.trim();
            const price = parseFloat(document.getElementById('newProductPrice').value);
            const stock = parseInt(document.getElementById('newProductStock').value);
            const category = document.getElementById('newProductCategory').value;
            const description = document.getElementById('newProductDesc').value.trim();
            
            if (!name || !price || stock < 0) {
                showNotification('Please fill all required fields correctly', 'error');
                return;
            }
            
            const newPid = Math.max(...products.map(p => p.pid)) + 1;
            
            products.push({
                pid: newPid,
                name: name,
                price: price,
                qty: stock,
                status: 'Active',
                category: category,
                description: description,
                reorderLevel: Math.max(1, Math.floor(stock * 0.2)),
                lastUpdated: new Date()
            });
            
            // Clear form
            document.getElementById('newProductName').value = '';
            document.getElementById('newProductPrice').value = '';
            document.getElementById('newProductStock').value = '';
            document.getElementById('newProductDesc').value = '';
            
            displayProducts();
            updateDashboard();
            closeModal('addProductModal');
            showNotification(`Product "${name}" added successfully!`, 'success');
            addActivity(`Added new product: ${name}`);
        }

        function exportProducts() {
            const csvContent = "data:text/csv;charset=utf-8," + 
                "ID,Name,Price,Stock,Status,Category\n" +
                products.map(p => `${p.pid},"${p.name}",${p.price},${p.qty},${p.status},${p.category || 'N/A'}`).join('\n');
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', `products_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Products exported successfully!', 'success');
            addActivity('Exported products to CSV');
        }

        function generateReports() {
            const reportContent = `
    ═══════════════════════════════════════════════
                    BUSINESS REPORT
                   ${new Date().toLocaleDateString()}
    ═══════════════════════════════════════════════
    
    SALES SUMMARY:
    Total Sales: ₹${totalSales.toLocaleString()}
    Total Orders: ${totalOrders}
    Average Order Value: ₹${totalOrders > 0 ? Math.round(totalSales / totalOrders).toLocaleString() : '0'}
    
    INVENTORY SUMMARY:
    Total Products: ${products.length}
    Active Products: ${products.filter(p => p.status === 'Active').length}
    Low Stock Items: ${products.filter(p => p.qty <= p.reorderLevel).length}
    Out of Stock Items: ${products.filter(p => p.qty === 0).length}
    Total Inventory Value: ₹${products.reduce((sum, p) => sum + (p.price * p.qty), 0).toLocaleString()}
    
    CUSTOMER SUMMARY:
    Total Customers: ${Object.keys(customers).length}
    Loyal Customers (100+ points): ${Object.values(customers).filter(c => c.points > 100).length}
    Gold/Platinum Members: ${Object.values(customers).filter(c => c.points >= 750).length}
    
    TOP PRODUCTS BY STOCK:
    ${products.sort((a, b) => b.qty - a.qty).slice(0, 5).map((p, i) => 
        `${i + 1}. ${p.name}: ${p.qty} units`).join('\n    ')}
    
    LOW STOCK ALERTS:
    ${products.filter(p => p.qty <= p.reorderLevel && p.status === 'Active').map(p => 
        `⚠️ ${p.name}: ${p.qty} units (Reorder at ${p.reorderLevel})`).join('\n    ') || 'No low stock items'}
    
    ═══════════════════════════════════════════════
            Generated by Inventa AI Gene
    ═══════════════════════════════════════════════
    `;
            
            const printWindow = window.open('', '_blank', 'width=800,height=600');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Business Report</title>
                        <style>
                            body { 
                                font-family: 'Courier New', monospace; 
                                white-space: pre-wrap; 
                                margin: 20px;
                                font-size: 12px;
                            }
                        </style>
                    </head>
                    <body>${reportContent}</body>
                </html>
            `);
            printWindow.document.close();
            
            addActivity('Generated business report');
            showNotification('Report generated successfully!', 'success');
        }

        function openBarcodeScanner() {
            showNotification('Barcode scanner feature coming soon!', 'warning');
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            localStorage.setItem('darkMode', isDarkMode);
            showNotification(`${isDarkMode ? 'Dark' : 'Light'} mode activated`, 'success');
        }

        // Activity Tracking
        function addActivity(activity) {
            activities.unshift({
                timestamp: new Date(),
                activity: activity
            });
            
            // Keep only last 50 activities
            activities = activities.slice(0, 50);
            localStorage.setItem('activities', JSON.stringify(activities));
        }

        function displayRecentActivities() {
            const activitiesDiv = document.getElementById('recentActivities');
            if (activities.length === 0) {
                activitiesDiv.innerHTML = '<div style="text-align: center; color: #666;">No recent activities</div>';
                return;
            }
            
            activitiesDiv.innerHTML = activities.slice(0, 10).map(activity => `
                <div style="padding: 8px; border-bottom: 1px solid #eee; font-size: 14px;">
                    <div style="font-weight: 600;">${activity.activity}</div>
                    <div style="font-size: 12px; color: #666;">${activity.timestamp.toLocaleString()}</div>
                </div>
            `).join('');
        }

        // Notification System
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Data Management
        function saveAllData() {
            localStorage.setItem('products', JSON.stringify(products));
            localStorage.setItem('customers', JSON.stringify(customers));
            localStorage.setItem('activities', JSON.stringify(activities));
            localStorage.setItem('totalSales', totalSales.toString());
            localStorage.setItem('totalOrders', totalOrders.toString());
        }

        function saveCustomerData() {
            localStorage.setItem('customers', JSON.stringify(customers));
        }

        function logout() {
            if (confirm('Are you sure you want to logout? All unsaved data will be lost.')) {
                saveAllData();
                showNotification('Logged out successfully!', 'success');
                setTimeout(() => {
                    location.reload();
                }, 1000);
            }
        }

        // Load saved dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            toggleDarkMode();
        }

        // Auto-update displays
        setInterval(() => {
            displayCoupons();
            updateDashboard();
        }, 30000);

        // Window click events for modals
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 'n':
                        e.preventDefault();
                        openAddProductModal();
                        break;
                    case 'p':
                        e.preventDefault();
                        printBill();
                        break;
                    case 'g':
                        e.preventDefault();
                        generateBill();
                        break;
                }
            }
        });
    </script>
</body>
</html>
